<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ãƒ“ãƒƒã‚¯ãƒªãƒãƒ³ãƒãƒ§ã‚³ - ã‚·ãƒ¼ãƒ«å‡ºç¾ç‡</title>
    <link rel="stylesheet" href="style.css">
    <link rel="stylesheet" href="rarity.css">
</head>
<body>
    <div class="container">
        <h1>ã‚·ãƒ¼ãƒ«ã®å‡ºç¾ç‡ä¸€è¦§</h1>
        <p><a href="index.html" class="back-link">&laquo; ãƒ“ãƒƒã‚¯ãƒªãƒãƒ³ãƒãƒ§ã‚³ã«æˆ»ã‚‹</a></p>
        <div id="rarity-table-container">
            <!-- ã“ã“ã«JavaScriptã§ãƒ†ãƒ¼ãƒ–ãƒ«ãŒç”Ÿæˆã•ã‚Œã¾ã™ -->
        </div>
    </div>
    <script src="image-data.js"></script>
    <script>
        // ğŸ–¼ï¸ ç”»åƒãƒ‡ãƒ¼ã‚¿ã¯ image-data.js ã‹ã‚‰ allImagesData ã‚’å‚ç…§
        const imagesData = allImagesData;

        document.addEventListener('DOMContentLoaded', function() {
            const rarityTableContainer = document.getElementById('rarity-table-container');
            if (!rarityTableContainer) return;

            const sortedImagesData = [...imagesData].sort((a, b) => {
                const weightA = a.weight || 0;
                const weightB = b.weight || 0;
                if (weightB !== weightA) {
                    return weightB - weightA;
                }
                return 0;
            });

            // é †ä½ã‚’è¨ˆç®—ã—ã¦ãƒ‡ãƒ¼ã‚¿ã«è¿½åŠ 
            let rank = 0;
            let lastWeight = Infinity; // å‰ã®ã‚¢ã‚¤ãƒ†ãƒ ã®weightã‚’ä¿æŒ (æœ€åˆã¯æœ€å¤§å€¤ã‚ˆã‚Šå¤§ãã„å€¤)
            const rankedImagesData = sortedImagesData.map((image, index) => {
                const currentWeight = image.weight || 0;
                if (currentWeight < lastWeight) {
                    rank = index + 1; // weightãŒå¤‰ã‚ã£ãŸã‚‰ã€ç¾åœ¨ã®ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹+1ã‚’é †ä½ã¨ã™ã‚‹
                }
                // weightãŒåŒã˜å ´åˆã¯ã€å‰ã®ã‚¢ã‚¤ãƒ†ãƒ ã¨åŒã˜rankãŒä½¿ã‚ã‚Œã‚‹
                lastWeight = currentWeight;
                return { ...image, displayRank: rank };
            });

            const totalWeight = rankedImagesData.reduce((sum, img) => sum + (img.weight || 0), 0);

            if (totalWeight <= 0) {
                rarityTableContainer.innerHTML = '<p>å‡ºç¾ç‡ã‚’è¨ˆç®—ã§ãã¾ã›ã‚“ã§ã—ãŸã€‚</p>';
                return;
            }

            const table = document.createElement('table');
            table.className = 'rarity-table';

            // ãƒ†ãƒ¼ãƒ–ãƒ«ãƒ˜ãƒƒãƒ€ãƒ¼ã‚’ä½œæˆ
            const thead = document.createElement('thead');
            const headerRow = document.createElement('tr');
            const thRank = document.createElement('th'); // é †ä½ãƒ˜ãƒƒãƒ€ãƒ¼
            thRank.textContent = 'é †ä½';
            const thDescription = document.createElement('th');
            thDescription.textContent = 'èª¬æ˜';
            const thPercentage = document.createElement('th');
            thPercentage.textContent = 'å‡ºç¾ç‡';
            headerRow.appendChild(thRank); // é †ä½ãƒ˜ãƒƒãƒ€ãƒ¼ã‚’è¿½åŠ 
            headerRow.appendChild(thDescription);
            headerRow.appendChild(thPercentage);
            thead.appendChild(headerRow);
            table.appendChild(thead);

            // ãƒ†ãƒ¼ãƒ–ãƒ«ãƒœãƒ‡ã‚£ã‚’ä½œæˆ
            const tbody = document.createElement('tbody');
            rankedImagesData.forEach(image => { // é †ä½æƒ…å ±ãŒå«ã¾ã‚ŒãŸãƒ‡ãƒ¼ã‚¿ã‚’ä½¿ç”¨
                const percentage = ((image.weight || 0) / totalWeight) * 100;
                const row = document.createElement('tr');

                const tdRank = document.createElement('td'); // é †ä½ã‚»ãƒ«
                tdRank.textContent = image.displayRank;
                tdRank.className = 'rarity-rank-cell';

                const tdDescription = document.createElement('td');
                tdDescription.textContent = image.description;
                tdDescription.className = 'rarity-description-cell';

                const tdPercentage = document.createElement('td');
                tdPercentage.textContent = `${percentage.toFixed(2)}%`;
                tdPercentage.className = 'rarity-percentage-cell';

                row.appendChild(tdRank); // é †ä½ã‚»ãƒ«ã‚’è¿½åŠ 
                row.appendChild(tdDescription);
                row.appendChild(tdPercentage);
                tbody.appendChild(row);
            });
            table.appendChild(tbody);

            rarityTableContainer.appendChild(table);
        });
    </script>
</body>
</html>